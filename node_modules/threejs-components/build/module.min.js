import{Clock as e,PerspectiveCamera as t,Scene as i,WebGLRenderer as s,SRGBColorSpace as n,MathUtils as o,Vector2 as r,Color as a,InstancedMesh as c,PlaneGeometry as l,MeshBasicMaterial as h,AdditiveBlending as d,Object3D as u,Vector3 as m,TextureLoader as p,MeshPhysicalMaterial as f,ShaderChunk as v,FrontSide as g,PointLight as y,LatheGeometry as x,PCFSoftShadowMap as w,Raycaster as z,Plane as S,WebGLRenderTarget as b,RGBAFormat as M,FloatType as P,LinearFilter as C,ShaderMaterial as A,Uniform as R,Mesh as D,MeshStandardMaterial as L,PMREMGenerator as T,EquirectangularReflectionMapping as F,CatmullRomCurve3 as U,OrthographicCamera as I,Vector4 as k,SphereGeometry as E,AmbientLight as O,ACESFilmicToneMapping as B,DirectionalLight as _,BufferGeometry as N,Float32BufferAttribute as V,PointsMaterial as j,Points as q,SplineCurve as W,HalfFloatType as H}from"three";import{EffectComposer as Y}from"three/examples/jsm/postprocessing/EffectComposer.js";import{RenderPass as Z}from"three/examples/jsm/postprocessing/RenderPass.js";import{UnrealBloomPass as X}from"three/examples/jsm/postprocessing/UnrealBloomPass.js";import{OutputPass as G}from"three/examples/jsm/postprocessing/OutputPass.js";import"three/examples/jsm/loaders/GLTFLoader.js";import"three/examples/jsm/loaders/DRACOLoader.js";import{HDRLoader as Q}from"three/examples/jsm/loaders/HDRLoader.js";import{RoomEnvironment as $}from"three/examples/jsm/environments/RoomEnvironment.js";import{FullScreenQuad as J}from"three/examples/jsm/postprocessing/Pass.js";import{ShaderPass as K}from"three/examples/jsm/postprocessing/ShaderPass.js";import{Clock as ee,PerspectiveCamera as te,Scene as ie,WebGPURenderer as se,SRGBColorSpace as ne,MathUtils as oe,Vector3 as re,Vector4 as ae,InstancedMesh as ce,MeshStandardNodeMaterial as le,DirectionalLight as he,PostProcessing as de,Raycaster as ue,Plane as me,Color as pe,FrontSide as fe,DoubleSide as ve,PlaneGeometry as ge,CircleGeometry as ye,SphereGeometry as xe,OctahedronGeometry as we,BoxGeometry as ze,Mesh as Se,TubeGeometry as be,CatmullRomCurve3 as Me,PointLight as Pe,MeshStandardMaterial as Ce}from"three/webgpu";import{uniform as Ae,instancedArray as Re,Fn as De,length as Le,min as Te,instanceIndex as Fe,If as Ue,smoothstep as Ie,rotate as ke,attribute as Ee,normalLocal as Oe,pass as Be,mrt as _e,output as Ne}from"three/tsl";import{bloom as Ve}from"three/addons/tsl/display/BloomNode.js";import{GPUComputationRenderer as je}from"three/examples/jsm/misc/GPUComputationRenderer.js";let qe=class{#e;canvas;camera;cameraMinAspect;cameraMaxAspect;cameraFov;maxPixelRatio;minPixelRatio;scene;renderer;#t;size={width:0,height:0,wWidth:0,wHeight:0,ratio:0,pixelRatio:0};render=this.#i;onBeforeRender=()=>{};onAfterRender=()=>{};onAfterResize=()=>{};#s=!1;#n=!1;isDisposed=!1;#o;#r;#a;#c=new e;#l={elapsed:0,delta:0};#h;#d;#u=0;#m=0;constructor(e){this.#e={...e},this.#p(),this.#f(),this.#v(),this.resize(),this.#g()}#p(){this.camera=new t,this.cameraFov=this.camera.fov}#f(){this.scene=new i}#v(){this.#e.canvas?this.canvas=this.#e.canvas:this.#e.id?this.canvas=document.getElementById(this.#e.id):console.error("Three: Missing canvas or id parameter"),this.canvas.style.display="block",this.canvas.style.touchAction="none";const e={canvas:this.canvas,powerPreference:"high-performance",...this.#e.rendererOptions??{}};this.renderer=new s(e),this.renderer.outputColorSpace=n}#g(){this.#e.size instanceof Object||(window.addEventListener("resize",this.#y.bind(this)),"parent"===this.#e.size&&(this.#r=new ResizeObserver(this.#y.bind(this)),this.#r.observe(this.canvas.parentNode))),this.#o=new IntersectionObserver(this.#x.bind(this),{root:null,rootMargin:"0px",threshold:0}),this.#o.observe(this.canvas),document.addEventListener("visibilitychange",this.#w.bind(this))}#z(){window.removeEventListener("resize",this.#y.bind(this)),this.#r?.disconnect(),this.#o?.disconnect(),document.removeEventListener("visibilitychange",this.#w.bind(this))}#x(e){this.#s=e[0].isIntersecting,this.#s?this.#S():this.#b()}#w(e){this.#s&&(document.hidden?this.#b():this.#S())}#y(){this.#a&&clearTimeout(this.#a),this.#a=setTimeout(this.resize.bind(this),100)}resize(){let e,t;this.#e.size instanceof Object?(e=this.#e.size.width,t=this.#e.size.height):"parent"===this.#e.size&&this.canvas.parentNode?(e=this.canvas.parentNode.offsetWidth,t=this.canvas.parentNode.offsetHeight):(e=window.innerWidth,t=window.innerHeight),this.size.width=e,this.size.height=t,this.size.ratio=e/t,this.#M(),this.#P(),this.onAfterResize(this.size)}#M(){this.camera.aspect=this.size.width/this.size.height,this.camera.isPerspectiveCamera&&this.cameraFov&&(this.cameraMinAspect&&this.camera.aspect<this.cameraMinAspect?this.#C(this.cameraMinAspect):this.cameraMaxAspect&&this.camera.aspect>this.cameraMaxAspect?this.#C(this.cameraMaxAspect):this.camera.fov=this.cameraFov),this.camera.updateProjectionMatrix(),this.updateWorldSize()}#C(e){const t=Math.tan(o.degToRad(this.cameraFov/2))/(this.camera.aspect/e);this.camera.fov=2*o.radToDeg(Math.atan(t))}updateWorldSize(){if(this.camera.isPerspectiveCamera){const e=this.camera.fov*Math.PI/180;this.size.wHeight=2*Math.tan(e/2)*this.camera.position.length(),this.size.wWidth=this.size.wHeight*this.camera.aspect}else this.camera.isOrthographicCamera&&(this.size.wHeight=this.camera.top-this.camera.bottom,this.size.wWidth=this.camera.right-this.camera.left)}#P(){this.renderer.setSize(this.size.width,this.size.height),this.#t?.setSize(this.size.width,this.size.height);let e=window.devicePixelRatio;this.maxPixelRatio&&e>this.maxPixelRatio?e=this.maxPixelRatio:this.minPixelRatio&&e<this.minPixelRatio&&(e=this.minPixelRatio),this.renderer.setPixelRatio(e),this.size.pixelRatio=e}get postprocessing(){return this.#t}set postprocessing(e){this.#t=e,this.render=e.render.bind(e)}get fpsLimit(){return this.#d}set fpsLimit(e){this.#d=e,this.#u=e>0?1/e:0}#S(){if(this.#n)return;const e=()=>{this.#h=requestAnimationFrame(e),this.#l.elapsed=this.#c.getElapsedTime();const t=this.#l.elapsed-this.#m;(!this.#d||this.#d&&t>this.#u)&&(this.#l.delta=t,this.onBeforeRender(this.#l),this.render(),this.onAfterRender(this.#l),this.#m=this.#l.elapsed)};this.#n=!0,this.#c.start(),e()}#b(){this.#n&&(cancelAnimationFrame(this.#h),this.#n=!1,this.#c.stop(),this.#m=0)}#i(){this.renderer.render(this.scene,this.camera)}clear(){this.scene.traverse(e=>{e.isMesh&&"object"==typeof e.material&&(Object.keys(e.material).forEach(t=>{const i=e.material[t];null!==i&&"object"==typeof i&&"function"==typeof i.dispose&&i.dispose()}),e.material.dispose(),e.geometry.dispose())}),this.scene.clear()}dispose(){this.#z(),this.#b(),this.clear(),this.#t?.dispose(),this.renderer.dispose(),this.isDisposed=!0}};const We=new Map,He=new r;let Ye=!1;function Ze(e){const t={position:new r,nPosition:new r,hover:!1,pressed:!1,onEnter(){},onLeave(){},onMove(){},onDown(){},onUp(){},onClick(){},...e};return function(e,t){We.has(e)||(We.set(e,t),Ye||(document.body.addEventListener("pointermove",Ge),document.body.addEventListener("pointerleave",Qe),document.body.addEventListener("pointerdown",$e),document.body.addEventListener("pointerup",Je),document.body.addEventListener("click",Ke),Ye=!0))}(e.domElement,t),t.dispose=()=>{var t;t=e.domElement,We.delete(t),0===We.size&&(document.body.removeEventListener("pointermove",Ge),document.body.removeEventListener("pointerleave",Qe),document.body.removeEventListener("pointerdown",$e),document.body.removeEventListener("pointerup",Je),document.body.removeEventListener("click",Ke),Ye=!1)},t}function Xe(e,t){He.x=e.clientX,He.y=e.clientY;for(const[e,i]of We){t(i,e.getBoundingClientRect())}}function Ge(e){Xe(e,(t,i)=>{tt(i)?(et(t,i),t.hover||(t.hover=!0,t.onEnter(t)),t.pressed=e.buttons>0,t.onMove(t)):t.hover&&(t.hover=!1,t.pressed=!1,t.onLeave(t))})}function Qe(){for(const e of We.values())e.hover&&(e.hover=!1,e.onLeave(e))}function $e(e){Xe(e,(e,t)=>{tt(t)&&(et(e,t),e.onDown(e))})}function Je(e){Xe(e,(e,t)=>{tt(t)&&(et(e,t),e.onUp(e))})}function Ke(e){Xe(e,(e,t)=>{tt(t)&&(et(e,t),e.onClick(e))})}function et(e,t){const{position:i,nPosition:s}=e;i.x=He.x-t.left,i.y=He.y-t.top,s.x=i.x/t.width*2-1,s.y=-i.y/t.height*2+1}function tt(e){const{x:t,y:i}=He,{left:s,top:n,width:o,height:r}=e;return t>=s&&t<=s+o&&i>=n&&i<=n+r}function it(e){let t,i;return s(e),{setColors:s,getColorAt:function(e,s=new a){const n=Math.max(0,Math.min(1,e))*(t.length-1),o=Math.floor(n),r=i[o];if(o>=t.length-1)s.copy(r);else{const e=n-o,t=i[o+1];s.r=r.r+e*(t.r-r.r),s.g=r.g+e*(t.g-r.g),s.b=r.b+e*(t.b-r.b)}return s}};function s(e){t=e,i=[],t.forEach(e=>{const t=new a(e);i.push(t)})}}var st="vec4 permute(vec4 x){vec4 xm=mod(x,289.0);return mod(((xm*34.0)+10.0)*xm,289.0);}float psrdnoise(vec3 x,vec3 period,float alpha,out vec3 gradient){\n#ifndef PERLINGRID\nconst mat3 M=mat3(0.0,1.0,1.0,1.0,0.0,1.0,1.0,1.0,0.0);const mat3 Mi=mat3(-0.5,0.5,0.5,0.5,-0.5,0.5,0.5,0.5,-0.5);\n#endif\nvec3 uvw;\n#ifndef PERLINGRID\nuvw=M*x;\n#else\nuvw=x+dot(x,vec3(1.0/3.0));\n#endif\nvec3 i0=floor(uvw);vec3 f0=fract(uvw);vec3 g_=step(f0.xyx,f0.yzz);vec3 l_=1.0-g_;vec3 g=vec3(l_.z,g_.xy);vec3 l=vec3(l_.xy,g_.z);vec3 o1=min(g,l);vec3 o2=max(g,l);vec3 i1=i0+o1;vec3 i2=i0+o2;vec3 i3=i0+vec3(1.0);vec3 v0,v1,v2,v3;\n#ifndef PERLINGRID\nv0=Mi*i0;v1=Mi*i1;v2=Mi*i2;v3=Mi*i3;\n#else\nv0=i0-dot(i0,vec3(1.0/6.0));v1=i1-dot(i1,vec3(1.0/6.0));v2=i2-dot(i2,vec3(1.0/6.0));v3=i3-dot(i3,vec3(1.0/6.0));\n#endif\nvec3 x0=x-v0;vec3 x1=x-v1;vec3 x2=x-v2;vec3 x3=x-v3;if(any(greaterThan(period,vec3(0.0)))){vec4 vx=vec4(v0.x,v1.x,v2.x,v3.x);vec4 vy=vec4(v0.y,v1.y,v2.y,v3.y);vec4 vz=vec4(v0.z,v1.z,v2.z,v3.z);if(period.x>0.0)vx=mod(vx,period.x);if(period.y>0.0)vy=mod(vy,period.y);if(period.z>0.0)vz=mod(vz,period.z);\n#ifndef PERLINGRID\ni0=M*vec3(vx.x,vy.x,vz.x);i1=M*vec3(vx.y,vy.y,vz.y);i2=M*vec3(vx.z,vy.z,vz.z);i3=M*vec3(vx.w,vy.w,vz.w);\n#else\nv0=vec3(vx.x,vy.x,vz.x);v1=vec3(vx.y,vy.y,vz.y);v2=vec3(vx.z,vy.z,vz.z);v3=vec3(vx.w,vy.w,vz.w);i0=v0+dot(v0,vec3(1.0/3.0));i1=v1+dot(v1,vec3(1.0/3.0));i2=v2+dot(v2,vec3(1.0/3.0));i3=v3+dot(v3,vec3(1.0/3.0));\n#endif\ni0=floor(i0+0.5);i1=floor(i1+0.5);i2=floor(i2+0.5);i3=floor(i3+0.5);}vec4 hash=permute(permute(permute(vec4(i0.z,i1.z,i2.z,i3.z))+vec4(i0.y,i1.y,i2.y,i3.y))+vec4(i0.x,i1.x,i2.x,i3.x));vec4 theta=hash*3.883222077;vec4 sz=hash*-0.006920415+0.996539792;vec4 psi=hash*0.108705628;vec4 Ct=cos(theta);vec4 St=sin(theta);vec4 sz_prime=sqrt(1.0-sz*sz);vec4 gx,gy,gz;\n#ifdef FASTROTATION\nvec4 qx=St;vec4 qy=-Ct;vec4 qz=vec4(0.0);vec4 px=sz*qy;vec4 py=-sz*qx;vec4 pz=sz_prime;psi+=alpha;vec4 Sa=sin(psi);vec4 Ca=cos(psi);gx=Ca*px+Sa*qx;gy=Ca*py+Sa*qy;gz=Ca*pz+Sa*qz;\n#else\nif(alpha!=0.0){vec4 Sp=sin(psi);vec4 Cp=cos(psi);vec4 px=Ct*sz_prime;vec4 py=St*sz_prime;vec4 pz=sz;vec4 Ctp=St*Sp-Ct*Cp;vec4 qx=mix(Ctp*St,Sp,sz);vec4 qy=mix(-Ctp*Ct,Cp,sz);vec4 qz=-(py*Cp+px*Sp);vec4 Sa=vec4(sin(alpha));vec4 Ca=vec4(cos(alpha));gx=Ca*px+Sa*qx;gy=Ca*py+Sa*qy;gz=Ca*pz+Sa*qz;}else{gx=Ct*sz_prime;gy=St*sz_prime;gz=sz;}\n#endif\nvec3 g0=vec3(gx.x,gy.x,gz.x);vec3 g1=vec3(gx.y,gy.y,gz.y);vec3 g2=vec3(gx.z,gy.z,gz.z);vec3 g3=vec3(gx.w,gy.w,gz.w);vec4 w=0.5-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3));w=max(w,0.0);vec4 w2=w*w;vec4 w3=w2*w;vec4 gdotx=vec4(dot(g0,x0),dot(g1,x1),dot(g2,x2),dot(g3,x3));float n=dot(w3,gdotx);vec4 dw=-6.0*w2*gdotx;vec3 dn0=w3.x*g0+dw.x*x0;vec3 dn1=w3.y*g1+dw.y*x1;vec3 dn2=w3.z*g2+dw.z*x2;vec3 dn3=w3.w*g3+dw.w*x3;gradient=39.5*(dn0+dn1+dn2+dn3);return 39.5*n;}";const{randFloatSpread:nt}=o,ot={count:1024,size:.5,colors:[0]};class rt extends c{constructor(e){const t={...ot,...e},i=new l(t.size,t.size),s=new h({blending:d,opacity:.5,depthWrite:!1}),n={uRatio:{value:new r(1,1)},uBlurLevel:{value:4},uFocalLength:{value:1},uFocusDistance:{value:1},uMinScale:{value:.1},uMaxScale:{value:1.4},uTime:{value:0},uTimeScale:{value:1},uNoiseCoordScale:{value:3},uNoiseDisplacementScale:{value:.005}};s.onBeforeCompile=e=>{Object.assign(e.uniforms,n),e.vertexShader=`\n        ${st}\n        uniform vec2 uRatio;\n        uniform float uFocalLength;\n        uniform float uFocusDistance;\n        uniform float uMinScale;\n        uniform float uMaxScale;\n        uniform float uTime;\n        uniform float uNoiseCoordScale;\n        uniform float uNoiseDisplacementScale;\n        varying float vBokeh;\n      `+e.vertexShader,e.vertexShader=e.vertexShader.replace("#include <project_vertex>","vec4 mvPosition=vec4(0.0,0.0,0.0,1.0);mvPosition=instanceMatrix*mvPosition;vec3 grad;psrdnoise(mvPosition.xyz*uNoiseCoordScale,vec3(0),uTime*0.5,grad);grad*=uNoiseCoordScale;mvPosition.xyz+=grad*uNoiseDisplacementScale;float d=length(mvPosition.xyz-cameraPosition);vBokeh=smoothstep(0.0,uFocalLength,abs(d-uFocusDistance));float scale=uMinScale+uMaxScale*vBokeh;mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;gl_Position.xy+=transformed.xy*uRatio*scale*instanceMatrix[0][0];"),e.fragmentShader="\n        uniform float uBlurLevel;\n        varying float vBokeh;\n      "+e.fragmentShader,e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>","#ifdef USE_MAP\nvec2 uv=vMapUv;uv.y/=8.0;float blurLevel=uBlurLevel*vBokeh;float uvY=floor(blurLevel);float uvYFract=fract(blurLevel);uv.y+=0.125*uvY;vec4 tex1=texture2D(map,uv);uv.y+=0.125;vec4 tex2=texture2D(map,uv);vec4 sampledDiffuseColor=mix(tex1,tex2,uvYFract);diffuseColor*=sampledDiffuseColor;\n#else\ndiffuseColor.a=0.0;\n#endif\n")},super(i,s,t.count),this.config=t,this.uniforms=n,this.dummyO=new u,this.#A()}#A(){for(let e=0;e<this.count;e++)this.dummyO.position.set(nt(2),nt(2),nt(1.7)),this.dummyO.scale.set(1,1,1).multiplyScalar(o.randFloat(.5,1)),this.dummyO.updateMatrix(),this.setMatrixAt(e,this.dummyO.matrix);this.#R()}#R(){const e=it(this.config.colors);for(let t=0;t<this.count;t++)this.setColorAt(t,e.getColorAt(Math.random()));this.instanceColor.needsUpdate=!0}setColors(e){this.config.colors=e,this.#R()}update(e){this.uniforms.uTime.value+=e.delta*this.uniforms.uTimeScale.value}setSize(e,t){e>t?this.uniforms.uRatio.value.set(1,e/t):this.uniforms.uRatio.value.set(t/e,1)}}function at(e,t={}){const i=new qe({canvas:e,size:"parent"});i.cameraMaxAspect=1.7,i.camera.position.z=1,i.updateWorldSize();const s=new rt;s.setSize(i.size.width,i.size.height),i.scene.add(s);const n=new m,o=Ze({domElement:e});o.onMove=()=>{n.x=.1*-o.nPosition.x,n.y=.1*-o.nPosition.y},i.onBeforeRender=e=>{s.position.lerp(n,.05),s.update(e)},i.onAfterResize=e=>{s.setSize(e.width,e.height)};const r=new p;return{three:i,particles:s,loadMap:function(e){r.load(e,e=>{e.flipY=!1,s.material.map=e,s.material.needsUpdate=!0})},setBackgroundColor(e){i.scene.background=new a(e)},setColors:s.setColors.bind(s),dispose(){o.dispose(),i.dispose()}}}class ct extends f{constructor(e){super(e);this.uniforms={thicknessDistortion:{value:.1},thicknessAmbient:{value:0},thicknessAttenuation:{value:.1},thicknessPower:{value:2},thicknessScale:{value:10}},this.defines.USE_UV="",this.onBeforeCompile=e=>{Object.assign(e.uniforms,this.uniforms),e.fragmentShader="\n        uniform float thicknessPower;\n        uniform float thicknessScale;\n        uniform float thicknessDistortion;\n        uniform float thicknessAmbient;\n        uniform float thicknessAttenuation;\n      "+e.fragmentShader,e.fragmentShader=e.fragmentShader.replace("void main() {","\n        void RE_Direct_Scattering(const in IncidentLight directLight, const in vec2 uv, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, inout ReflectedLight reflectedLight) {\n          vec3 scatteringHalf = normalize(directLight.direction + (geometryNormal * thicknessDistortion));\n          float scatteringDot = pow(saturate(dot(geometryViewDir, -scatteringHalf)), thicknessPower) * thicknessScale;\n          #ifdef USE_COLOR\n            vec3 scatteringIllu = (scatteringDot + thicknessAmbient) * vColor;\n          #else\n            vec3 scatteringIllu = (scatteringDot + thicknessAmbient) * diffuse;\n          #endif\n          reflectedLight.directDiffuse += scatteringIllu * thicknessAttenuation * directLight.color;\n        }\n\n        void main() {\n      ");const t=v.lights_fragment_begin.replaceAll("RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );","\n          RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n          RE_Direct_Scattering(directLight, vUv, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, reflectedLight);\n        ");e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",t),this.onBeforeCompile2&&this.onBeforeCompile2(e)}}}const{randFloatSpread:lt,smoothstep:ht}=o,dt={type:"hexagon",n:20,padding:0,light1Color:16777215,light1Intensity:1e3,light1PositionZ:5,light2Color:16711680,light2Intensity:500,light2PositionZ:-20,colors:[255,2105376,16777215],materialParams:{metalness:.8,roughness:.5,clearcoat:1,clearcoatRoughness:.1},timeCoef:1,depthScale:1,tiltRotationX:.15,tiltRotationY:.15};class ut extends c{#D;#l=0;#L;#T;pointerPosition=new m;tilt=new m;#F=new m;#U=new u;#I=new r;constructor(e,t){const i={...dt,...t};let s;"triangle"===i.type?(s=3,i.width=100/(i.n/2+.5),i.height=Math.sin(Math.PI/3)*i.width,i.radius=.5*i.width/Math.cos(Math.PI/6),i.nx=i.n,i.ny=Math.floor(3*i.n/5)):"square"===i.type?(s=4,i.width=100/i.n,i.height=100/i.n,i.radius=.5*i.width,i.nx=i.n,i.ny=Math.floor(2*i.n)):(s="hexagon"===i.type?6:16,i.radius=50/i.n,i.nx=i.n,i.ny=i.n);const n=function(e,t,i,s=0,n=0,o=3){const a=[];a.push(new r(t,-i/2));for(let e=0;e<o;e++){const c=t-s+Math.cos(e/(o-1)*Math.PI/2)*s,l=i/2-n+Math.sin(e/(o-1)*Math.PI/2)*n;a.push(new r(c,l))}a.push(new r(0,i/2));const c=new x(a,e);return c.translate(0,-i/2,0),c.rotateX(Math.PI/2),c}(s,i.radius,10*i.radius,.125*i.radius,.125*i.radius);super(n,new ct({...i.materialParams,side:g}),i.nx*i.ny),this.#D=e,this.config=i,this.#L=this.#k(),this.#T=new Float32Array(this.count).fill(0).map(()=>lt(2*Math.PI)),this.#E(),this.castShadow=!0,this.receiveShadow=!0,this.setColors(i.colors)}#E(){const e=new y(this.config.light1Color,this.config.light1Intensity);e.positionZ=this.config.light1PositionZ,e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,this.light1=e,this.#D.scene.add(this.light1);const t=new y(this.config.light2Color,this.config.light2Intensity);t.positionZ=this.config.light2PositionZ,this.light2=t,this.#D.scene.add(this.light2)}#k(){return"triangle"===this.config.type?function({nx:e,ny:t,width:i,height:s,radius:n}){const o=i/2,r=s,a=-e/2*o+o/2,c=-t/2*r+r/2;return mt({nx:e,ny:t},(e,t)=>({x:a+e*o,y:c+t*r+.5*(t%2?-1:1)*(s-n)+e%2*(t%2?1:-1)*(2*n-s),rotZ:(e+t%2)%2*Math.PI/3}))}(this.config):"square"===this.config.type?function({nx:e,ny:t,width:i,height:s}){const n=i,o=s/2,r=-e/2*n+n/4,a=-t/2*o+o/2;return mt({nx:e,ny:t},(e,t)=>({x:r+e*n+t%2/2*n,y:a+t*o,rotZ:0}))}(this.config):"hexagon"===this.config.type?function({nx:e,ny:t,radius:i}){const s=Math.cos(Math.PI/6)*i*2,n=1.5*i,o=-e/2*s+s/4,r=-t/2*n+n/2;return mt({nx:e,ny:t},(e,t)=>({x:o+e*s+t%2/2*s,y:r+t*n,rotZ:0}))}(this.config):function({nx:e,ny:t,radius:i}){const s=2*i,n=Math.sin(Math.PI/3)*s,o=-e/2*s+s/4,r=-t/2*n+n/2;return mt({nx:e,ny:t},(e,t)=>({x:o+e*s+t%2/2*s,y:r+t*n,rotZ:0}))}(this.config)}#O(){for(let e=0;e<this.config.nx;e++)for(let t=0;t<this.config.ny;t++){const i=e*this.config.ny+t,s=this.#L[i],n=this.#I.set(s.x,s.y).multiplyScalar(this.scale.x).sub(this.pointerPosition).length(),o=1-ht(n,0,20*this.config.radius);this.#U.position.x=s.x,this.#U.position.y=s.y,this.#U.position.z=.5*(Math.cos(this.#T[i]+this.#l)-1)*this.config.radius*this.config.depthScale*o,this.#U.rotation.z=s.rotZ,this.#U.scale.set(1-this.config.padding,1-this.config.padding,1),this.#U.updateMatrix(),this.setMatrixAt(i,this.#U.matrix)}this.instanceMatrix.needsUpdate=!0}setColors(e){if(Array.isArray(e)&&e.length>1){const t=it(e);for(let e=0;e<this.count;e++)this.setColorAt(e,t.getColorAt(Math.random()));this.instanceColor.needsUpdate=!0}}resize(){this.#D.size.ratio>1?(this.scale.x=this.#D.size.wWidth/100*1.4,this.scale.y=this.scale.x):(this.scale.y=this.#D.size.wHeight/100*1.4,this.scale.x=this.scale.y)}update(e){this.#l+=e.delta*this.config.timeCoef,this.light1.position.set(this.pointerPosition.x,this.pointerPosition.y,this.light1.positionZ),this.light2.position.set(this.pointerPosition.x,this.pointerPosition.y,this.light2.positionZ),this.#F.lerp(this.tilt,.1),this.rotation.set(this.#F.x*this.config.tiltRotationX,this.#F.y*this.config.tiltRotationY,0),this.#O()}}function mt({nx:e,ny:t},i){const s=new Array(e*t).fill(0);for(let n=0;n<e;n++)for(let e=0;e<t;e++){s[n*t+e]=i(n,e)}return s}function pt(e,t={}){const i=new qe({canvas:e,size:"parent",rendererOptions:{antialias:!0,stencil:!1,depth:!1}});i.cameraMaxAspect=1,i.camera.position.z=100,i.updateWorldSize(),i.renderer.shadowMap.enabled=!0,i.renderer.shadowMap.type=w;const s=new Z(i.scene,i.camera),n=new X(new r(i.size.width,i.size.height));n.radius=0,n.strength=.2,n.threshold=0;const o=new G,a=new Y(i.renderer);a.addPass(s),a.addPass(n),a.addPass(o),i.postprocessing=a;const c=new ut(i,t);i.scene.add(c),c.resize();const l=new z,h=new S(new m(0,0,1),0),d=new m,u=Ze({domElement:e});return u.onMove=()=>{l.setFromCamera(u.nPosition,i.camera),i.camera.getWorldDirection(h.normal),l.ray.intersectPlane(h,d),c.tilt.set(-u.nPosition.y,u.nPosition.x,0)},u.onLeave=()=>{d.set(0,0,0),c.tilt.set(0,0,0)},i.onBeforeRender=e=>{c.pointerPosition.lerp(d,.1),c.update(e)},i.onAfterResize=e=>{c.resize()},{three:i,bloomPass:n,grid:c,dispose(){u.dispose(),i.dispose()}}}let ft,vt;async function gt(e,t){let i;return i=e.endsWith(".hdr")?await function(e,t){vt||(vt=new Q);return vt.loadAsync(e,t)}(e,t):await function(e,t){ft||(ft=new p);return ft.loadAsync(e,t)}(e,t),i}var yt="varying vec2 vUv;void main(){vUv=uv;gl_Position=vec4(position,1.0);}";const xt=512;class wt{#B;#_;#N;attenuation;#V;#j;#q;#W;#H;#Y;#Z;#X=[];constructor({renderer:e}){this.#B=e,this.#_={value:1},this.#N={value:new r(1/xt,1/xt)},this.attenuation={value:.995},this.#G(),this.#Q()}#G(){const e={minFilter:C,magFilter:C,type:P,format:M,depthBuffer:!1,stencilBuffer:!1};this.#V=new b(xt,xt,e),this.#j=new b(xt,xt,e),this.#q=new J}#Q(){this.#W=new A({uniforms:{tDiffuse:{value:null}},vertexShader:yt,fragmentShader:"uniform sampler2D tDiffuse;varying vec2 vUv;void main(){gl_FragColor=texture2D(tDiffuse,vUv);}"}),this.#H=new A({uniforms:{tDiffuse:{value:null},texelSize:this.#N,attenuation:this.attenuation},vertexShader:yt,fragmentShader:"uniform sampler2D tDiffuse;uniform vec2 texelSize;uniform float attenuation;varying vec2 vUv;void main(){vec4 texel=texture2D(tDiffuse,vUv);vec2 dx=vec2(texelSize.x,0.0);vec2 dy=vec2(0.0,texelSize.y);float average=(texture2D(tDiffuse,vUv-dx).r+texture2D(tDiffuse,vUv-dy).r+texture2D(tDiffuse,vUv+dx).r+texture2D(tDiffuse,vUv+dy).r)*0.25;texel.g+=(average-texel.r)*2.0;texel.g*=attenuation;texel.r+=texel.g;gl_FragColor=texel;}"}),this.#Y=new A({uniforms:{tDiffuse:{value:null},texelSize:this.#N},vertexShader:yt,fragmentShader:"uniform sampler2D tDiffuse;uniform vec2 texelSize;varying vec2 vUv;void main(){vec4 texel=texture2D(tDiffuse,vUv);vec3 dx=vec3(texelSize.x,0.0,texture2D(tDiffuse,vec2(vUv.x+texelSize.x,vUv.y)).r-texel.r);vec3 dy=vec3(0.0,texelSize.y,texture2D(tDiffuse,vec2(vUv.x,vUv.y+texelSize.y)).r-texel.r);texel.ba=normalize(cross(dx,dy)).xy;gl_FragColor=texel;}"}),this.#Z=new A({uniforms:{tDiffuse:{value:null},aspectRatio:this.#_,center:new R(new r),radius:{value:.05},strength:{value:.5}},vertexShader:yt,fragmentShader:"const float PI=3.1415926535897932384626433832795;uniform sampler2D tDiffuse;uniform float aspectRatio;uniform vec2 center;uniform float radius;uniform float strength;varying vec2 vUv;void main(){vec4 texel=texture2D(tDiffuse,vUv);vec2 p=center*0.5+0.5-vUv;p.x*=aspectRatio;float drop=max(0.0,1.0-length(p)/radius);drop=0.5-cos(drop*PI)*0.5;texel.r+=drop*strength;gl_FragColor=texel;}"})}get texture(){return this.#V.texture}setSize({width:e,height:t,ratio:i}){let s=e,n=t;e>t?(s=xt,n=Math.floor(t*(xt/e))):(n=xt,s=Math.floor(e*(xt/t))),this.#_.value=i,this.#N.value.set(1/s,1/n),this.#V.setSize(s,n),this.#j.setSize(s,n)}update(){const e=this.#B.getRenderTarget();this.#$(),this.#J(),this.#K(),this.#B.setRenderTarget(e)}#J(){this.#H.uniforms.tDiffuse.value=this.#V.texture,this.#ee(this.#H,this.#j),this.#te()}#K(){this.#Y.uniforms.tDiffuse.value=this.#V.texture,this.#ee(this.#Y,this.#j),this.#te()}addDrop(e,t,i,s){this.#X.push({x:e,y:t,radius:i,strength:s})}#$(){for(let e=0;e<this.#X.length;e++){const t=this.#X[e];this.#ie(t.x,t.y,t.radius,t.strength)}this.#X.splice(0)}#ie(e,t,i,s){this.#Z.uniforms.tDiffuse.value=this.#V.texture,this.#Z.uniforms.center.value.set(e,t),this.#Z.uniforms.radius.value=this.#_.value>1?i*this.#_.value:i,this.#Z.uniforms.strength.value=s,this.#ee(this.#Z,this.#j),this.#te()}#ee(e,t){this.#q.material=e,this.#B.setRenderTarget(t),this.#q.render(this.#B)}#te(){const e=this.#V;this.#V=this.#j,this.#j=e}dispose(){this.#W.dispose(),this.#H.dispose(),this.#Y.dispose(),this.#Z.dispose(),this.#V.dispose(),this.#j.dispose()}}class zt extends D{#se;#ne=1;constructor({renderer:e}){super(new l(1,1,1,1),new L({metalness:.75,roughness:.5})),this.rotation.x=-Math.PI/2,this.#se=new wt({renderer:e}),this.uniforms={uvMapScale:{value:new r(1,1)},displacementMap:{value:this.#se.texture},displacementScale:{value:1}},this.material.defines={USE_UV:""},this.material.onBeforeCompile=e=>{Object.assign(e.uniforms,this.uniforms),e.fragmentShader="\n        uniform vec2 uvMapScale;\n        uniform sampler2D displacementMap;\n        uniform float displacementScale;\n\n        float redOffset   = 0.01;\n        float greenOffset = 0.02;\n        float blueOffset  = 0.03;\n      "+e.fragmentShader,e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>","\n        vec4 disp = texture2D(displacementMap, vUv);\n        vec3 transformedNormal = vec3(disp.b, disp.a, sqrt(1.0 - dot(disp.ba, disp.ba)));\n        #ifdef USE_MAP\n          // vec2 newUv = ((vUv - 0.5) * uvMapScale + 0.5) + transformedNormal.xy * transformedNormal.z * displacementScale * 0.02;\n          vec2 dUv = transformedNormal.xy * displacementScale * 0.02;\n          vec2 newUv = ((vUv - 0.5) * uvMapScale + 0.5) + dUv;\n          float st = smoothstep(0.0, 0.1, length(dUv));\n          diffuseColor.r *= texture2D(map, newUv + redOffset * st).r;\n          diffuseColor.g *= texture2D(map, newUv + greenOffset * st).g;\n          diffuseColor.b *= texture2D(map, newUv + blueOffset * st).b;\n          // vec4 sampledDiffuseColor = texture2D(map, newUv);\n          // diffuseColor *= sampledDiffuseColor;\n        #endif\n      "),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>","\n        normal = transformedNormal;\n      ")};const t=new T(e).fromScene(new $,.04).texture;this.material.envMap=t}get attenuation(){return this.#se.attenuation.value}set attenuation(e){this.#se.attenuation.value=e}update(){this.#se.update()}addDrop(e,t,i,s){this.#se.addDrop(e,t,i,s)}setImage(e){this.material.map=e,this.material.needsUpdate=!0,this.#oe()}#oe(){const e=this.material.map;if(e&&e.image){const t=e.image.width/e.image.height;this.#ne<t?this.uniforms.uvMapScale.value.set(this.#ne/t,1):this.uniforms.uvMapScale.value.set(1,t/this.#ne)}else this.uniforms.uvMapScale.value.set(1,1)}setEnvMap(e){this.material.envMap=e,this.material.needsUpdate=!0}setSize(e){this.#ne=e.ratio,this.scale.set(e.wWidth,e.wHeight,1),this.#oe(),this.#se.setSize(e)}dispose(){this.#se.dispose()}}const{randFloatSpread:St,randFloat:bt}=o;function Mt(e,t={}){const i=new qe({canvas:e,size:"parent"});i.camera.position.y=10,i.camera.lookAt(0,0,0),i.updateWorldSize();const s=new zt({renderer:i.renderer});s.setSize(i.size),i.scene.add(s);const o={enable:!0,time:0,timeDelta:.05},r=Ze({domElement:e});return r.onMove=()=>{s.addDrop(r.nPosition.x,r.nPosition.y,.025,.0025)},r.onClick=()=>{s.addDrop(r.nPosition.x,r.nPosition.y,.025,.05)},i.onBeforeRender=e=>{o.enable&&(o.time+=e.delta,o.time>o.timeDelta&&(s.addDrop(St(2),St(2),bt(.01,.02),bt(.001,.005)),o.time=0)),s.update()},i.onAfterResize=e=>{s.setSize(e)},{three:i,liquidPlane:s,async loadImage(e){if(e){const t=await gt(e);t.colorSpace=n,s.setImage(t)}else s.setImage(null)},async loadEnvMap(e){if(e){const t=await gt(e);t.colorSpace=n,t.mapping=F,s.setEnvMap(t)}else s.setEnvMap(null)},setRain(e){o.enable=e},setRainTime(e){o.timeDelta=e},dispose:()=>{r.dispose(),s.dispose(),i.dispose()}}}const Pt={segments:128,colors:["#c7d8e2","#aa3b8c","#3c97ee"],points:[{x:0,y:5,z:20},{x:0,y:0,z:0},{x:0,y:-5,z:20}],closed:!1,offsetScale:{x:10,y:0,z:0},neonSize:5,timeScale:10},{randFloat:Ct,randFloatSpread:At}=o;function Rt(e,i={}){const s=new qe({canvas:e,size:"parent"});s.maxPixelRatio=1,s.camera=new I;const n=function(e){const i={...Pt,...e},s=2*i.segments,n={positions:new Array(i.segments).fill().map(()=>new m),colors:new Array(i.segments).fill().map(()=>new a),lengths:new Array(i.segments).fill().map(()=>Ct(.005,.03)),timeOffsets:new Array(i.segments).fill().map(()=>Ct(0,1)),velocities:new Array(i.segments).fill().map(()=>Ct(.5,1))};let o;const c={width:0,height:0},h={value:0},d={value:new r},u={value:i.neonSize},p={value:new Array(s).fill().map(()=>new m)},f={value:n.colors.map(e=>e.clone())},v={uTime:h,uRatio:d,uNeonSize:u,uPoints:p,uColors:f};let g,y,x;const w=new m;return function(){g=new t,g.position.set(0,0,25),g.updateProjectionMatrix(),g.updateMatrixWorld(),y=new A({uniforms:v,defines:{NUM_SEGMENTS:i.segments,NUM_POINTS:s},vertexShader:"varying vec2 vUv;void main(){vUv=uv;gl_Position=vec4(position,1.0);}",fragmentShader:"uniform vec2 uRatio;uniform float uNeonSize;uniform vec3 uPoints[NUM_POINTS];uniform vec3 uColors[NUM_SEGMENTS];varying vec2 vUv;float sdSegment(in vec2 p,in vec2 a,in vec2 b){vec2 pa=p-a,ba=b-a;float h=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-ba*h);}void main(){vec2 pos=(vUv-0.5)*uRatio;vec3 col=vec3(0.0);for(int i=0;i<NUM_SEGMENTS;i++){vec3 p1=uPoints[i*2];vec3 p2=uPoints[i*2+1];if((p1.z<-1.0||p1.z>1.0)||(p2.z<-1.0||p2.z>1.0))continue;float dist=sdSegment(pos,p1.xy,p2.xy);float glow=uNeonSize/dist;col+=glow*uColors[i];}gl_FragColor=vec4(col,1.0);}"}),x=new D(new l(2,2),y),o=new U([]),S(i.points),o.closed=i.closed;for(let e=0;e<i.segments;e++)n.positions[e].set(At(1),At(1),At(1));z(i.colors)}(),Object.assign(x,{update:function(e){let t,s;h.value+=e.delta*i.timeScale;for(let e=0;e<i.segments;e++){const r=n.positions[e],a=p.value[2*e],c=p.value[2*e+1];t=(n.timeOffsets[e]+h.value*n.velocities[e]*.025)%1,s=o.closed?(t+n.lengths[e])%1:Math.min(1,t+n.lengths[e]),o.getPoint(t,a),o.getPoint(s,c),w.x=r.x*i.offsetScale.x,w.y=r.y*i.offsetScale.y,w.z=r.z*i.offsetScale.z,a.add(w),a.project(g),c.add(w),c.project(g),o.closed||f.value[e].copy(n.colors[e]).multiplyScalar(Math.sin(Math.PI*t))}},setColors:z,setCurvePoints:S,setCurveClosed:function(e){o.closed=e},setCurveOffsetScale:function(e){i.offsetScale=e},setNeonSize:function(e){i.neonSize=e,c.width>=c.height?u.value=i.neonSize/c.width:u.value=i.neonSize/c.height},setVelocity:function(e){i.timeScale=e},setSize:function(e,t){c.width=e,c.height=t,e>=t?(d.value.set(1,t/e),u.value=i.neonSize/e):(d.value.set(e/t,1),u.value=i.neonSize/t)}}),x;function z(e){const t=it(e);for(let e=0;e<i.segments;e++)n.colors[e].copy(t.getColorAt(Ct(0,1))),f.value[e].copy(n.colors[e]);const s=e.map(e=>{const t=new a;return t.set(e),t.getHexString()});console.log("debugColors",s)}function S(e){o.points=e.map(e=>e.isVector3?e:new m(e.x,e.y,e.z))}}(i);return n.setSize(s.size.width,s.size.height),s.scene.add(n),s.onBeforeRender=e=>{n.update(e)},s.onAfterResize=e=>{n.setSize(e.width,e.height)},{three:s,neon:n,setColors:n.setColors,setCurvePoints:n.setCurvePoints,setCurveClosed:n.setCurveClosed,setCurveOffsetScale:n.setCurveOffsetScale,setNeonSize:n.setNeonSize,setVelocity:n.setVelocity,dispose:s.dispose.bind(s)}}class Dt extends D{speed=1;constructor(){const e={iResolution:{value:new r},iTime:{value:0},iTimeDelta:{value:0},iMouse:{value:new k}};super(new l(2,2),new A({uniforms:e})),this.uniforms=e}get fragmentShader(){return this.material.fragmentShader}set fragmentShader(e){if(!e)return;const t=`\n      uniform vec2 iResolution;\n      uniform float iTime;\n      uniform float iTimeDelta;\n      uniform vec4 iMouse;\n\n      ${e}\n\n      void main() {\n        mainImage(gl_FragColor, gl_FragCoord.xy);\n      }\n    `;this.material.fragmentShader=t,this.material.needsUpdate=!0}update(e){this.uniforms.iTime.value+=e.delta*this.speed,this.uniforms.iTimeDelta.value=e.delta*this.speed}setSize({width:e,height:t,pixelRatio:i}){this.uniforms.iResolution.value.set(e*i,t*i)}dispose(){this.material.dispose(),this.geometry.dispose()}}function Lt(e,{fragmentShader:t}={}){const i=new qe({canvas:e,size:"parent"});i.camera=new I,i.camera.position.z=1;const s=new Dt;t&&(s.fragmentShader=t),i.scene.add(s);const n=Ze({domElement:e,onDown(){const e=n.position.x*i.size.pixelRatio,t=(i.size.height-n.position.y)*i.size.pixelRatio;s.uniforms.iMouse.value.x=e,s.uniforms.iMouse.value.y=t,s.uniforms.iMouse.value.z=e,s.uniforms.iMouse.value.w=t},onUp(){const e=s.uniforms.iMouse.value.z;s.uniforms.iMouse.value.z=e>0?-e:e},onMove(){const e=n.position.x*i.size.pixelRatio,t=(i.size.height-n.position.y)*i.size.pixelRatio;if(n.pressed){s.uniforms.iMouse.value.x=e,s.uniforms.iMouse.value.y=t;const i=s.uniforms.iMouse.value.z;s.uniforms.iMouse.value.z=i<0?-i:i}}});return i.onBeforeRender=e=>{s.update(e)},i.onAfterRender=()=>{const e=s.uniforms.iMouse.value.w;s.uniforms.iMouse.value.w=e>0?-e:e},i.onAfterResize=e=>{s.setSize(e)},{three:i,shaderPlane:s,dispose(){n.dispose(),i.dispose()}}}const{randFloat:Tt,randFloatSpread:Ft}=o,Ut=new m,It=new m,kt=new m,Et=new m,Ot=new m,Bt=new m,_t=new m,Nt=new m,Vt=new m,jt=new m;let qt=class{constructor(e){this.config=e,this.positionData=new Float32Array(3*e.count).fill(0),this.velocityData=new Float32Array(3*e.count).fill(0),this.sizeData=new Float32Array(e.count).fill(1),this.center=new m,this.#re(),this.setSizes()}#re(){const{config:e,positionData:t}=this;this.center.toArray(t,0);for(let i=1;i<e.count;i++){const s=3*i;t[s]=Ft(2*e.maxX),t[s+1]=Ft(2*e.maxY),t[s+2]=Ft(2*e.maxZ)}}setSizes(){const{config:e,sizeData:t}=this;t[0]=e.size0;for(let i=1;i<e.count;i++)t[i]=Tt(e.minSize,e.maxSize)}update(e){const{config:t,center:i,positionData:s,sizeData:n,velocityData:o}=this;let r=0;t.controlSphere0&&(r=1,Ut.fromArray(s,0),Ut.lerp(i,.1).toArray(s,0),Et.set(0,0,0).toArray(o,0));for(let i=r;i<t.count;i++){const r=3*i;It.fromArray(s,r),Ot.fromArray(o,r),Ot.y-=e.delta*t.gravity*n[i],Ot.multiplyScalar(t.friction),Ot.clampLength(0,t.maxVelocity),It.add(Ot),It.toArray(s,r),Ot.toArray(o,r)}for(let e=r;e<t.count;e++){const i=3*e;It.fromArray(s,i),Ot.fromArray(o,i);const r=n[e];for(let a=e+1;a<t.count;a++){const e=3*a;kt.fromArray(s,e),Bt.fromArray(o,e);const t=n[a];_t.copy(kt).sub(It);const c=_t.length(),l=r+t;if(c<l){const t=l-c;Nt.copy(_t).normalize().multiplyScalar(.5*t),Vt.copy(Nt).multiplyScalar(Math.max(Ot.length(),1)),jt.copy(Nt).multiplyScalar(Math.max(Bt.length(),1)),It.sub(Nt),Ot.sub(Vt),It.toArray(s,i),Ot.toArray(o,i),kt.add(Nt),Bt.add(jt),kt.toArray(s,e),Bt.toArray(o,e)}}if(t.controlSphere0){_t.copy(Ut).sub(It);const e=_t.length(),t=r+n[0];if(e<t){const i=t-e;Nt.copy(_t).normalize().multiplyScalar(i),Vt.copy(Nt).multiplyScalar(Math.max(Ot.length(),2)),It.sub(Nt),Ot.sub(Vt)}}Math.abs(It.x)+r>t.maxX&&(It.x=Math.sign(It.x)*(t.maxX-r),Ot.x=-Ot.x*t.wallBounce),0===t.gravity?Math.abs(It.y)+r>t.maxY&&(It.y=Math.sign(It.y)*(t.maxY-r),Ot.y=-Ot.y*t.wallBounce):It.y-r<-t.maxY&&(It.y=-t.maxY+r,Ot.y=-Ot.y*t.wallBounce);const a=Math.max(t.maxZ,t.maxSize);Math.abs(It.z)+r>a&&(It.z=Math.sign(It.z)*(t.maxZ-r),Ot.z=-Ot.z*t.wallBounce),It.toArray(s,i),Ot.toArray(o,i)}}};const Wt={count:200,colors:[255,0,16777215],ambientColor:16777215,ambientIntensity:1,lightIntensity:200,materialParams:{metalness:.5,roughness:.5,clearcoat:1,clearcoatRoughness:.15},minSize:.5,maxSize:1,size0:1,gravity:.5,friction:.9975,wallBounce:.95,maxVelocity:.15,maxX:5,maxY:5,maxZ:2,controlSphere0:!1},Ht=new u;let Yt=class extends c{constructor(e,t={}){const i={...Wt,...t},s=new $,n=new T(e,.04).fromScene(s).texture,o=new E,r=new ct({envMap:n,...i.materialParams});r.envMapRotation.x=-Math.PI/2,super(o,r,i.count),this.config=i,this.physics=new qt(i),this.#E(),this.setColors(i.colors)}#E(){this.ambientLight=new O(this.config.ambientColor,this.config.ambientIntensity),this.add(this.ambientLight),this.light=new y(this.config.colors[0],this.config.lightIntensity),this.add(this.light)}setColors(e){if(Array.isArray(e)&&e.length>1){const t=it(e);for(let e=0;e<this.count;e++)this.setColorAt(e,t.getColorAt(e/this.count)),0===e&&this.light.color.copy(t.getColorAt(e/this.count));this.instanceColor.needsUpdate=!0}}update(e){this.physics.update(e);for(let e=0;e<this.count;e++)Ht.position.fromArray(this.physics.positionData,3*e),Ht.scale.setScalar(this.physics.sizeData[e]),Ht.updateMatrix(),this.setMatrixAt(e,Ht.matrix),0===e&&this.light.position.copy(Ht.position);this.instanceMatrix.needsUpdate=!0}};function Zt(e,t={}){const i=new qe({canvas:e,size:"parent",rendererOptions:{antialias:!0,alpha:!0}});let s;i.renderer.toneMapping=B,i.camera.position.set(0,0,20),i.camera.lookAt(0,0,0),i.cameraMaxAspect=1.5,i.resize(),l(t);const n=new z,o=new S(new m(0,0,1),0),r=new m;let a=!1;const c=Ze({domElement:e,onMove(){n.setFromCamera(c.nPosition,i.camera),i.camera.getWorldDirection(o.normal),n.ray.intersectPlane(o,r),s.physics.center.copy(r),s.config.controlSphere0=!0},onLeave(){s.config.controlSphere0=!1}});function l(e){s&&(i.clear(),i.scene.remove(s)),s=new Yt(i.renderer,e),i.scene.add(s)}return i.onBeforeRender=e=>{a||s.update(e)},i.onAfterResize=e=>{s.config.maxX=e.wWidth/2,s.config.maxY=e.wHeight/2},{three:i,get spheres(){return s},setCount(e){l({...s.config,count:e})},togglePause(){a=!a},dispose(){c.dispose(),i.dispose()}}}const{randFloat:Xt,randFloatSpread:Gt}=o,Qt=new m,$t=new m,Jt=new m,Kt=new m,ei=new m,ti=new m,ii=new m,si=new m,ni=new m;class oi{constructor(e){this.config=e,this.positionData=new Float32Array(3*e.count).fill(0),this.velocityData=new Float32Array(3*e.count).fill(0),this.sizeData=new Float32Array(e.count).fill(1),this.center=new m,this.#re(),this.setSizes()}#re(){const{config:e,positionData:t}=this;this.center.toArray(t,0);for(let i=1;i<e.count;i++){const e=3*i;t[e]=Gt(10),t[e+1]=Gt(10),t[e+2]=Gt(10)}}setSizes(){const{config:e,sizeData:t}=this;t[0]=e.size0;for(let i=1;i<e.count;i++)t[i]=Xt(e.minSize,e.maxSize)}update(e){const{config:t,center:i,positionData:s,sizeData:n,velocityData:o}=this;Qt.fromArray(s,0),Qt.lerp(i,.1).toArray(s,0);for(let i=1;i<t.count;i++){const r=3*i;$t.fromArray(s,r),Kt.fromArray(o,r);const a=n[i];ti.copy(Qt).sub($t),Kt.add(ti.normalize().multiplyScalar(e.delta*t.attraction*a)),Kt.multiplyScalar(t.friction),Kt.clampLength(0,t.maxVelocity),$t.add(Kt),$t.toArray(s,r),Kt.toArray(o,r)}for(let e=1;e<t.count;e++){const i=3*e;$t.fromArray(s,i),Kt.fromArray(o,i);const r=n[e];for(let i=e+1;i<t.count;i++){const e=3*i;Jt.fromArray(s,e),ei.fromArray(o,e);const t=n[i];ti.copy(Jt).sub($t);const a=ti.length(),c=r+t;if(a<c){const t=c-a;ii.copy(ti).normalize().multiplyScalar(.5*t),si.copy(ii).multiplyScalar(Math.max(Kt.length(),1)),ni.copy(ii).multiplyScalar(Math.max(ei.length(),1)),$t.sub(ii),Kt.sub(si),Jt.add(ii),ei.add(ni),Jt.toArray(s,e),ei.toArray(o,e)}}ti.copy(Qt).sub($t);const a=ti.length(),c=r+n[0];if(a<c){const e=c-a;ii.copy(ti).normalize().multiplyScalar(e),si.copy(ii).multiplyScalar(Math.max(Kt.length(),2)),$t.sub(ii),Kt.sub(si)}$t.toArray(s,i),Kt.toArray(o,i)}}}const ri={count:200,colors:[16711680,0,16777215],pointLightIntensity:150,directionalLightColor:16777215,directionalLightIntensity:5,materialParams:{metalness:.5,roughness:.5,clearcoat:1,clearcoatRoughness:.15},minSize:.25,maxSize:1,size0:3,attraction:.15,friction:.9975,maxVelocity:.15},ai=new u;let ci=class extends c{constructor(e,t={}){const i={...ri,...t};super(new E,new ct(i.materialParams),i.count),this.castShadow=!0,this.receiveShadow=!0,this.config=i,this.physics=new oi(i),this.#E(),this.setColors(i.colors)}#E(){this.pointLight=new y(this.config.colors[0],this.config.pointLightIntensity),this.add(this.pointLight);const e=this.directionalLight=new _(this.config.directionalLightColor,this.config.directionalLightIntensity);e.position.set(20,20,20),e.target.position.set(0,0,0),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.far=70,e.shadow.camera.left=-17.5,e.shadow.camera.right=17.5,e.shadow.camera.top=17.5,e.shadow.camera.bottom=-17.5,this.add(e),this.add(e.target)}setColors(e){if(Array.isArray(e)&&e.length>1){const t=it(e);for(let e=0;e<this.count;e++)this.setColorAt(e,t.getColorAt(e/this.count)),0===e&&this.pointLight.color.copy(t.getColorAt(e/this.count));this.instanceColor.needsUpdate=!0}}update(e){this.physics.update(e);for(let e=0;e<this.count;e++)ai.position.fromArray(this.physics.positionData,3*e),ai.scale.setScalar(this.physics.sizeData[e]),ai.updateMatrix(),this.setMatrixAt(e,ai.matrix),0===e&&this.pointLight.position.copy(ai.position);this.instanceMatrix.needsUpdate=!0}};function li(e,t={}){const i=new qe({canvas:e,size:"parent",rendererOptions:{antialias:!0,alpha:!0}});i.renderer.shadowMap.enabled=!0,i.renderer.shadowMap.type=w,i.renderer.toneMapping=B,i.camera.position.set(0,0,30),i.camera.lookAt(0,0,0),i.cameraMaxAspect=1.5,i.resize();const s=new $,n=new T(i.renderer,.04).fromScene(s).texture;let o;d(t);const r=new z,a=new S(new m(0,0,1),0),c=new m;let l=!1;const h=Ze({domElement:e,onMove(){r.setFromCamera(h.nPosition,i.camera),i.camera.getWorldDirection(a.normal),r.ray.intersectPlane(a,c),o.physics.center.copy(c)},onLeave(){o.physics.center.set(0,0,0)}});function d(e){o&&(i.clear(),i.scene.remove(o)),o=new ci(i.renderer,e);const t=e.materialParams||{};void 0===t.envMap&&(o.material.envMap=n),void 0===t.envMapIntensity&&(o.material.envMapIntensity=.25),o.material.envMapRotation.x=-Math.PI/2,i.scene.add(o)}return i.onBeforeRender=e=>{l||o.update(e)},i.onAfterResize=e=>{o.config.maxX=e.wWidth/2,o.config.maxY=e.wHeight/2},{three:i,get spheres(){return o},setCount(e){d({...o.config,count:e})},togglePause(){l=!l},dispose(){h.dispose(),i.dispose()}}}const{randFloat:hi,randFloatSpread:di}=o,ui={count:5e4,colors:["#a70267","#f10c49","#fb6b41","#f6d86b","#339194"],map:null,timeScale:1};class mi extends u{#ae;#ce;constructor(e,t={}){super(),this.config={...ui,...t},this.#ae={uTime:{value:0}},this.#le()}#le(){this.geometry=new N;const e=new Float32Array(3*this.config.count),t=new Float32Array(this.config.count),i=new Float32Array(3*this.config.count),s=new m;for(let t=0;t<this.config.count;t++)s.set(di(200),di(200),di(300)),s.toArray(e,3*t);this.geometry.setAttribute("position",new V(e,3)),this.geometry.setAttribute("size2",new V(t,1)),this.geometry.setAttribute("color",new V(i,3)),this.setSizes(1,5),this.setColors(this.config.colors),this.material=new j({blending:d,depthTest:!1,depthWrite:!1,sizeAttenuation:!0,transparent:!0,vertexColors:!0}),this.config.map&&this.loadMap(this.config.map),this.material.onBeforeCompile=e=>{Object.assign(e.uniforms,this.#ae),e.vertexShader="\n        uniform float uTime;\n        attribute float size2;\n        varying float vAlpha;\n      "+e.vertexShader,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","\n        vec3 transformed = vec3(position);\n        transformed.z = -150. + mod(position.z + uTime, 300.);\n        vAlpha = smoothstep(-150.0, -125.0, transformed.z) * smoothstep(150.0, 125.0, transformed.z);\n      "),e.vertexShader=e.vertexShader.replace("gl_PointSize = size;","gl_PointSize = size2;"),e.fragmentShader="\n        varying float vAlpha;\n      "+e.fragmentShader,e.fragmentShader=e.fragmentShader.replace("#include <color_fragment>","\n        float alpha = vAlpha;\n        #ifndef USE_MAP\n          float dist = length(gl_PointCoord - 0.5);\n          if (dist > 0.5) discard;\n          alpha *= smoothstep(0.5, 0.0, dist);\n        #endif\n        diffuseColor.rgb *= vColor;\n        diffuseColor.a = alpha;\n      ")},this.particles=new q(this.geometry,this.material),this.add(this.particles)}loadMap(e){null===e?(this.material.map=null,this.material.needsUpdate=!0):(this.#ce||(this.#ce=new p),this.material.map=this.#ce.load(e),this.material.needsUpdate=!0)}setSizes(e,t){const i=this.geometry.attributes.size2.array;for(let s=0;s<this.config.count;s++)i[s]=hi(e,t);this.geometry.attributes.size2.needsUpdate=!0}setColors(e){const t=this.geometry.attributes.color.array,i=new a;for(let s=0;s<this.config.count;s++)i.set(e[Math.floor(Math.random()*e.length)]),i.toArray(t,3*s);this.geometry.attributes.color.needsUpdate=!0}update(e){this.#ae.uTime.value+=e.delta*this.config.timeScale*10}}var pi={uniforms:{tDiffuse:{value:null},center:{value:new r(.5,.5)},strength:{value:0}},vertexShader:"\n  varying vec2 vUv;\n    void main() {\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n  ",fragmentShader:"\n    uniform sampler2D tDiffuse;\n    uniform vec2 center;\n    uniform float strength;\n    varying vec2 vUv;\n\n    float random(vec3 scale, float seed) {\n      /* use the fragment position for a different seed per-pixel */\n      return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n    }\n    \n    void main() {\n      vec4 color = vec4(0.0);\n      float total = 0.0;\n      vec2 toCenter = center - vUv;\n      \n      /* randomize the lookup values to hide the fixed number of samples */\n      float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n      \n      for (float t = 0.0; t <= 40.0; t++) {\n        float percent = (t + offset) / 40.0;\n        float weight = 4.0 * (percent - percent * percent);\n        vec4 texel = texture2D(tDiffuse, vUv + toCenter * percent * strength);\n\n        /* switch to pre-multiplied alpha to correctly blur transparent images */\n        texel.rgb *= texel.a;\n\n        color += texel * weight;\n        total += weight;\n      }\n\n      gl_FragColor = color / total;\n\n      /* switch back from pre-multiplied alpha */\n      gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n    }\n  "};const{lerp:fi}=o;function vi(e,t={}){const i=new qe({canvas:e,size:"parent",rendererOptions:{antialias:!0}});i.camera.position.z=100,i.resize(),i.renderer.toneMapping=B;let s=1,n=1;const o=new Z(i.scene,i.camera),a=new X(new r(i.size.width/2,i.size.height/2));a.radius=0,a.strength=.5,a.threshold=0;const c=new K(pi),l=new G,h=new Y(i.renderer);h.addPass(o),h.addPass(a),h.addPass(c),h.addPass(l),i.postprocessing=h;const d=new mi(i,t);i.scene.add(d);const u=Ze({domElement:e});return i.onBeforeRender=e=>{const t=fi(d.position.x,5*-u.nPosition.x,.02),i=fi(d.position.y,5*-u.nPosition.y,.02);d.position.set(t,i,0),s+=.02*(n-s),c.uniforms.strength.value=.5*s/50,d.config.timeScale=s,d.update(e)},i.onAfterResize=e=>{h.setSize(e.width,e.height)},{three:i,bloomPass:a,particles:d,get velocity(){return s},set velocity(e){n=Math.min(Math.max(e,0),50)},dispose(){u.dispose(),i.dispose()}}}class gi{#e;canvas;camera;cameraMinAspect;cameraMaxAspect;cameraFov;maxPixelRatio;minPixelRatio;scene;renderer;size={width:0,height:0,wWidth:0,wHeight:0,ratio:0,pixelRatio:0};render=this.#i;onBeforeRender=()=>{};onAfterRender=()=>{};onAfterResize=()=>{};#s=!1;#n=!1;isDisposed=!1;#o;#r;#a;#c=new ee;#l={elapsed:0,delta:0};#d;#u=0;#m=0;constructor(e){this.#e={...e},this.#p(),this.#f(),this.#v(),this.resize(),this.#g()}#p(){this.camera=new te,this.cameraFov=this.camera.fov}#f(){this.scene=new ie}#v(){this.#e.canvas?this.canvas=this.#e.canvas:this.#e.id?this.canvas=document.getElementById(this.#e.id):console.error("Three: Missing canvas or id parameter"),this.canvas.style.display="block",this.canvas.style.touchAction="none";const e={canvas:this.canvas,...this.#e.rendererOptions??{}};this.renderer=new se(e),this.renderer.outputColorSpace=ne}#g(){this.#e.size instanceof Object||(window.addEventListener("resize",this.#y.bind(this)),"parent"===this.#e.size&&(this.#r=new ResizeObserver(this.#y.bind(this)),this.#r.observe(this.canvas.parentNode))),this.#o=new IntersectionObserver(this.#x.bind(this),{root:null,rootMargin:"0px",threshold:0}),this.#o.observe(this.canvas),document.addEventListener("visibilitychange",this.#w.bind(this))}#z(){window.removeEventListener("resize",this.#y.bind(this)),this.#r?.disconnect(),this.#o?.disconnect(),document.removeEventListener("visibilitychange",this.#w.bind(this))}#x(e){this.#s=e[0].isIntersecting,this.#s?this.#S():this.#b()}#w(e){this.#s&&(document.hidden?this.#b():this.#S())}#y(){this.#a&&clearTimeout(this.#a),this.#a=setTimeout(this.resize.bind(this),100)}resize(){let e,t;this.#e.size instanceof Object?(e=this.#e.size.width,t=this.#e.size.height):"parent"===this.#e.size&&this.canvas.parentNode?(e=this.canvas.parentNode.offsetWidth,t=this.canvas.parentNode.offsetHeight):(e=window.innerWidth,t=window.innerHeight),this.size.width=e,this.size.height=t,this.size.ratio=e/t,this.#M(),this.#P(),this.onAfterResize(this.size)}#M(){this.camera.aspect=this.size.width/this.size.height,this.camera.isPerspectiveCamera&&this.cameraFov&&(this.cameraMinAspect&&this.camera.aspect<this.cameraMinAspect?this.#C(this.cameraMinAspect):this.cameraMaxAspect&&this.camera.aspect>this.cameraMaxAspect?this.#C(this.cameraMaxAspect):this.camera.fov=this.cameraFov),this.camera.updateProjectionMatrix(),this.updateWorldSize()}#C(e){const t=Math.tan(oe.degToRad(this.cameraFov/2))/(this.camera.aspect/e);this.camera.fov=2*oe.radToDeg(Math.atan(t))}updateWorldSize(){if(this.camera.isPerspectiveCamera){const e=this.camera.fov*Math.PI/180;this.size.wHeight=2*Math.tan(e/2)*this.camera.position.length(),this.size.wWidth=this.size.wHeight*this.camera.aspect}else this.camera.isOrthographicCamera&&(this.size.wHeight=this.camera.top-this.camera.bottom,this.size.wWidth=this.camera.right-this.camera.left)}#P(){this.renderer.setSize(this.size.width,this.size.height);let e=window.devicePixelRatio;this.maxPixelRatio&&e>this.maxPixelRatio?e=this.maxPixelRatio:this.minPixelRatio&&e<this.minPixelRatio&&(e=this.minPixelRatio),this.renderer.setPixelRatio(e),this.size.pixelRatio=e}get fpsLimit(){return this.#d}set fpsLimit(e){this.#d=e,this.#u=e>0?1/e:0}#S(){this.#n||(this.#n=!0,this.#c.start(),this.renderer.setAnimationLoop(()=>{this.#l.elapsed=this.#c.getElapsedTime();const e=this.#l.elapsed-this.#m;(!this.#d||this.#d&&e>this.#u)&&(this.#l.delta=e,this.onBeforeRender(this.#l),this.render(),this.onAfterRender(this.#l),this.#m=this.#l.elapsed)}))}#b(){this.#n&&(this.renderer.setAnimationLoop(null),this.#n=!1,this.#c.stop(),this.#m=0)}#i(){this.renderer.render(this.scene,this.camera)}clear(){this.scene.traverse(e=>{e.isMesh&&"object"==typeof e.material&&(Object.keys(e.material).forEach(t=>{const i=e.material[t];null!==i&&"object"==typeof i&&"function"==typeof i.dispose&&i.dispose()}),e.material.dispose(),e.geometry.dispose())}),this.scene.clear()}dispose(){this.#z(),this.#b(),this.clear(),this.renderer.dispose(),this.isDisposed=!0}}const{randFloatSpread:yi,randFloat:xi}=oe;class wi{constructor(e,t){this.renderer=e,this.params=t;const i=Ae(0),s=Ae(t.attractionIntensity),n=Ae(t.maxVelocity),o=Ae(new re),r=Ae(0);this.uniforms={timeDelta:i,attractionIntensity:s,maxVelocity:n,pointer:o,click:r};const a=(()=>{const e=new Float32Array(4*t.count),i=new ae;for(let s=0;s<t.count;s++)i.set(xi(0,1),xi(0,1),xi(0,1),0),i.subScalar(.5).normalize().multiplyScalar(xi(0,200)),i.w=xi(.2,.5),i.toArray(e,4*s);return e})(),c=(()=>{const e=new Float32Array(4*t.count),i=new ae;for(let s=0;s<t.count;s++)i.set(0,0,0,xi(.1,.7)),i.toArray(e,4*s);return e})(),l=new Float32Array(3*t.count).fill(0).map(()=>yi(1)*Math.PI*2),h=new Float32Array(3*t.count).fill(0).map(()=>xi(0,1.25)),d=new Float32Array(3*t.count).fill(0).map(()=>xi(.25,1)),u=this.positionBuffer=Re(a,"vec4"),m=this.velocityBuffer=Re(c,"vec4"),p=this.rotationBuffer=Re(l,"vec3"),f=this.deltaRotationBuffer=Re(h,"vec3");this.colorBuffer=Re(d,"vec3");const v=De(([e,t])=>{const i=Le(e);return e.mul(Te(t,i).div(i))});this.computeParticles=De(()=>{const e=u.element(Fe),t=m.element(Fe);Ue(r.greaterThan(0),()=>{const i=e.xyz.sub(o),s=Le(i),n=Ie(50,0,s).mul(50);t.xyz.addAssign(i.normalize().mul(n))}).Else(()=>{const n=o.sub(e.xyz).normalize().mul(s).mul(e.w).mul(i);t.xyz.addAssign(n)}),t.xyz.assign(v(t.xyz,n)),e.xyz.addAssign(t.xyz);const a=p.element(Fe),c=f.element(Fe);a.addAssign(c.mul(i))})().compute(t.count)}async update(e){this.uniforms.timeDelta.value=e.delta,await this.renderer.computeAsync(this.computeParticles),this.uniforms.click.value=0}dispose(){this.positionBuffer.dispose(),this.rotationBuffer.dispose(),this.deltaRotationBuffer.dispose(),this.velocityBuffer.dispose(),this.colorBuffer.dispose()}}const zi={count:16384,size:1,materialParams:{metalness:.75,roughness:.25},attractionIntensity:1,maxVelocity:.5};let Si=class extends ce{constructor(e,t){const i={...zi,...t},s=new le(i.materialParams);super(i.geometry,s,i.count),this.params=i,this.frustumCulled=!1,this.initLights(),this.compute=new wi(e,this.params),this.uniforms={...this.compute.uniforms,size:Ae(this.params.size)},this.material.size=this.uniforms.size,this.material.colorNode=this.compute.colorBuffer.toAttribute();const n=this.compute.positionBuffer.toAttribute(),o=this.compute.rotationBuffer.toAttribute();this.material.positionNode=De(()=>{const e=ke(Ee("position"),o);return e.mulAssign(n.w.mul(this.material.size)).addAssign(n),Oe.assign(ke(Oe,o)),e})()}async update(e){await this.compute.update(e)}initLights(){const e=this.light1=new he(16748640,5);e.position.set(-50,-50,0),e.target.position.set(0,0,0),this.add(e),this.add(e.target);const t=this.light2=new he(6328575,5);t.position.set(50,50,0),t.target.position.set(0,0,0),this.add(t),this.add(t.target)}dispose(){this.compute.dispose(),this.geometry.dispose(),this.material.dispose()}};function bi(e,t={}){const i=new gi({canvas:e,size:"parent",rendererOptions:{alpha:!0}});i.camera.position.z=120,i.cameraMaxAspect=1.5,i.resize();const s=new de(i.renderer),n=Be(i.scene,i.camera);n.setMRT(_e({output:Ne}));const o=n.getTextureNode(),r=Ve(o,.5,0,0);s.outputNode=o.add(r),i.render=s.render.bind(s);const a=function(e,t){const i=function(e){let t;switch(e){case"box":t=new ze;break;case"octahedron":t=new we(1,0);break;case"sphere":t=new xe(1,6,4);break;case"circle":t=new ye(1,12);break;default:t=new ge}return t}(t.type||"box"),s=new Si(e,{...t,geometry:i});return s.material.side=["box","octahedron","sphere"].includes(t.type)?fe:ve,s.material.flatShading="sphere"===t.type,s}(i.renderer,t.particles||{});i.scene.add(a);const c=new ue,l=new me(new re(0,0,1),0),h=new re;let d=0,u=0;const m=Ze({domElement:e,onMove(){c.setFromCamera(m.nPosition,i.camera),i.camera.getWorldDirection(l.normal),c.ray.intersectPlane(l,h),a.compute.uniforms.pointer.value.copy(h),d=.75*m.nPosition.y,u=.75*-m.nPosition.x},onLeave(){a.compute.uniforms.pointer.value.set(0,0,0),d=0,u=0},onClick(){a.compute.uniforms.click.value=1}});return i.onBeforeRender=function(e){a.update(e),a.rotation.x+=.01*(d-a.rotation.x),a.rotation.y+=.01*(u-a.rotation.y)},{three:i,bloomPass:r,particles:a,setBackgroundColor(e){i.scene.background=e?new pe(e):null},dispose(){m.dispose(),a.dispose(),i.dispose()}}}const Mi={colors:[255,16711680],shaderPoints:16,curvePoints:64,curveLerp1:.5,curveLerp2:.5,radius1:5,radius2:5,sleepRadiusX:50,sleepRadiusY:50,sleepTimeScale1:2,sleepTimeScale2:2};function Pi(e,t={}){const i=new qe({canvas:e,size:"parent",rendererOptions:{alpha:!0}});i.camera=new I;const s=function(e){const t={...Mi,...e},i={width:0,height:0},s=it(t.colors),n=new Array(t.curvePoints).fill(0).map(()=>new r),o=new W(n),c=new r;let h=0,d=0;const u={value:new r},m={value:new r},p={value:new Array(t.shaderPoints).fill(0).map(()=>new r)},f={value:new a(16711935)},v={uRatio:u,uNeonSize:m,uPoints:p,uColor:f};let g,y;return function(){const e=new l(2,2);g=new A({uniforms:v,defines:{SHADER_POINTS:t.shaderPoints},vertexShader:"varying vec2 vUv;void main(){vUv=uv;gl_Position=vec4(position,1.0);}",fragmentShader:"float sdBezier(vec2 pos,vec2 A,vec2 B,vec2 C){vec2 a=B-A;vec2 b=A-2.0*B+C;vec2 c=a*2.0;vec2 d=A-pos;float kk=1.0/dot(b,b);float kx=kk*dot(a,b);float ky=kk*(2.0*dot(a,a)+dot(d,b))/3.0;float kz=kk*dot(d,a);float res=0.0;float p=ky-kx*kx;float p3=p*p*p;float q=kx*(2.0*kx*kx-3.0*ky)+kz;float h=q*q+4.0*p3;if(h>=0.0){h=sqrt(h);vec2 x=(vec2(h,-h)-q)/2.0;vec2 uv=sign(x)*pow(abs(x),vec2(1.0/3.0));float t=uv.x+uv.y-kx;t=clamp(t,0.0,1.0);vec2 qos=d+(c+b*t)*t;res=length(qos);}else{float z=sqrt(-p);float v=acos(q/(p*z*2.0))/3.0;float m=cos(v);float n=sin(v)*1.732050808;vec3 t=vec3(m+m,-n-m,n-m)*z-kx;t=clamp(t,0.0,1.0);vec2 qos=d+(c+b*t.x)*t.x;float dis=dot(qos,qos);res=dis;qos=d+(c+b*t.y)*t.y;dis=dot(qos,qos);res=min(res,dis);qos=d+(c+b*t.z)*t.z;dis=dot(qos,qos);res=min(res,dis);res=sqrt(res);}return res;}uniform vec2 uRatio;uniform vec2 uNeonSize;uniform vec2 uPoints[SHADER_POINTS];uniform vec3 uColor;varying vec2 vUv;void main(){vec2 pos=(vUv-0.5)*uRatio;vec2 c=(uPoints[0]+uPoints[1])/2.0;vec2 c_prev;float dist=10000.0;for(int i=0;i<SHADER_POINTS-1;i++){c_prev=c;c=(uPoints[i]+uPoints[i+1])/2.0;dist=min(dist,sdBezier(pos,c_prev,uPoints[i],c));}dist=max(0.0,dist);float glow=uNeonSize.y/dist;vec3 col=vec3(0.0);col+=10.0*vec3(smoothstep(uNeonSize.x,0.0,dist));col+=glow*uColor;col=1.0-exp(-col);col=pow(col,vec3(0.5));gl_FragColor=vec4(col,glow);}"}),y=new D(e,g)}(),Object.assign(y,{config:t,update:function({time:e,pointer:r}){if(r.hover)c.x=.5*r.nPosition.x*u.value.x,c.y=.5*r.nPosition.y*u.value.y,d=Math.min(o.points[0].distanceTo(c)/.05,1),h+=.05*(d-h),s.getColorAt(h,f.value);else{const n=e.elapsed*t.sleepTimeScale1,o=e.elapsed*t.sleepTimeScale2,r=Math.cos(n),a=Math.sin(o),l=t.sleepRadiusX/(i.width/u.value.x),h=t.sleepRadiusY/(i.height/u.value.y);c.x=l*r,c.y=h*a,s.getColorAt(.5+.5*Math.cos(e.elapsed),f.value)}o.points[0].lerp(c,t.curveLerp1);for(let e=1;e<t.curvePoints;e++)n[e].lerp(n[e-1],t.curveLerp2);for(let e=0;e<t.shaderPoints;e++)o.getPoint(e/(t.shaderPoints-1),p.value[e])},setColors:function(e){t.colors=e,s.setColors(e)},setSize:function(e,t){i.width=e,i.height=t,x()},updateUniforms:x}),y;function x(){m.value.set(t.radius1,t.radius2),i.width>=i.height?(u.value.set(1,i.height/i.width),m.value.multiplyScalar(1/i.width)):(u.value.set(i.width/i.height,1),m.value.multiplyScalar(1/i.height))}}(t);s.setSize(i.size.width,i.size.height),i.scene.add(s);const n=Ze({domElement:i.canvas});return i.onBeforeRender=e=>{s.update({time:e,pointer:n})},i.onAfterResize=e=>{s.setSize(e.width,e.height)},{three:i,neon:s,neonConfig:s.config,setColors:s.setColors,dispose:()=>{n.dispose(),i.dispose()}}}const{randFloat:Ci}=o,Ai={gpgpuSize:512,size:5,colors:[65280,255],color:16711680,decay:.0025,noiseCoordScale:.5,noiseIntensity:.001,noiseTimeCoef:.1,sleepRadiusX:200,sleepRadiusY:200,sleepTimeScale1:1,sleepTimeScale2:1};class Ri extends u{#D;#B;#ce;#he;uniforms;#de;#ue;#me;#pe=new m;constructor(e,t={}){super(),this.config={...Ai,...t},this.#D=e,this.#B=e.renderer,this.#he={uTime:{value:0},uPointerPosition:{value:new m},uPointerDirection:{value:new m},uDecay:{value:this.config.decay},uNoiseCoordScale:{value:this.config.noiseCoordScale},uNoiseIntensity:{value:this.config.noiseIntensity},uColor:{value:new a(this.config.color)},uPointSize:{value:this.config.size}},this.uniforms={tPosition:{value:null},tVelocity:{value:null},...this.#he},this.#fe(),this.#le()}#fe(){this.#de=new je(this.config.gpgpuSize,this.config.gpgpuSize,this.#B),this.#B.capabilities.isWebGL2||this.#de.setDataType(H),this.#ue=this.#de.createTexture(),this.#me=this.#de.createTexture(),this.#ve(this.#ue,this.#me),this.velocityVariable=this.#de.addVariable("textureVelocity",`\n      ${st}\n      uniform float uTime;\n      uniform float uNoiseCoordScale;\n      uniform float uNoiseIntensity;\n      void main() {\n        vec2 uv = gl_FragCoord.xy / resolution.xy;\n        vec4 pos = texture2D(texturePosition, uv);\n        vec4 vel = texture2D(textureVelocity, uv);\n\n        if (pos.w < 0.0) {\n          vel.x = 0.0; vel.y = 0.0; vel.z = 0.0;\n        } else {\n          vec3 grad;\n          psrdnoise(pos.xyz * uNoiseCoordScale, vec3(0.0), uTime, grad);\n          vel.xyz += grad * uNoiseIntensity * pos.w;\n        }\n        gl_FragColor = vel;\n      }\n    `,this.#me),this.positionVariable=this.#de.addVariable("texturePosition","\n      uniform float uDecay;\n      uniform vec3 uPointerPosition;\n      void main() {\n        vec2 uv = gl_FragCoord.xy / resolution.xy;\n        vec4 pos = texture2D(texturePosition, uv);\n        vec4 vel = texture2D(textureVelocity, uv);\n        if (pos.w < 0.0) { pos.w = vel.w; }\n        pos.w -= uDecay;\n        if (pos.w <= 0.0) {\n          pos.xyz = uPointerPosition;\n        } else {\n          pos.xyz += vel.xyz;\n        }\n        gl_FragColor = pos;\n      }\n    ",this.#ue),this.#de.setVariableDependencies(this.velocityVariable,[this.positionVariable,this.velocityVariable]),this.#de.setVariableDependencies(this.positionVariable,[this.positionVariable,this.velocityVariable]),this.#de.uniforms={...this.#he},Object.assign(this.velocityVariable.material.uniforms,this.#de.uniforms),Object.assign(this.positionVariable.material.uniforms,this.#de.uniforms);const e=this.#de.init();if(null!==e)throw new Error(e)}#ve(e,t){const i=new m,s=e.image.data,n=t.image.data;for(let e=0;e<this.config.gpgpuSize;e++)for(let t=0;t<this.config.gpgpuSize;t++){const o=4*(e+t*this.config.gpgpuSize);i.x=e/this.config.gpgpuSize-.5,i.y=t/this.config.gpgpuSize-.5,i.toArray(s,o),s[o+3]=Ci(.1,1),i.set(0,0,0).toArray(n,o),n[o+3]=Ci(.1,1)}}#le(){this.geometry=function(e){const t=new N,i=new Float32Array(e*e*3).fill(0),s=new Float32Array(e*e*2),n=new Float32Array(e*e*3);for(let t=0;t<e;t++)for(let i=0;i<e;i++){const n=t*e+i;s[2*n]=t/e,s[2*n+1]=i/e}return t.setAttribute("position",new V(i,3)),t.setAttribute("positionUv",new V(s,2)),t.setAttribute("color",new V(n,3)),t}(this.config.gpgpuSize),this.setColors(this.config.colors),this.material=new j({blending:d,depthTest:!1,depthWrite:!1,size:this.config.size,sizeAttenuation:!1,transparent:!0,vertexColors:!0}),this.config.map&&this.loadMap(this.config.map),this.material.onBeforeCompile=e=>{Object.assign(e.uniforms,this.uniforms),e.vertexShader="\n        uniform sampler2D tPosition;\n        uniform sampler2D tVelocity;\n        uniform float uPointSize;\n        attribute vec2 positionUv;\n        varying float alpha;\n      "+e.vertexShader,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","\n        vec4 pos = texture2D(tPosition, positionUv);\n        vec4 vel = texture2D(tVelocity, positionUv);\n        vec3 transformed = pos.xyz;\n        alpha = pos.w;\n      "),e.vertexShader=e.vertexShader.replace("gl_PointSize = size;","\n        gl_PointSize = uPointSize * pos.w * (vel.w + 0.5);\n      "),e.fragmentShader="\n        uniform vec3 uColor;\n        varying float alpha;\n      "+e.fragmentShader,e.fragmentShader=e.fragmentShader.replace("#include <color_fragment>","\n        #ifndef USE_MAP\n          float dist = length(gl_PointCoord - 0.5);\n          if (dist > 0.5) discard;\n        #endif\n        diffuseColor *= vec4(mix(vColor, uColor, alpha), alpha);\n      ")},this.particles=new q(this.geometry,this.material),this.add(this.particles)}loadMap(e){null===e?(this.material.map=null,this.material.needsUpdate=!0):(this.#ce||(this.#ce=new p),this.material.map=this.#ce.load(e),this.material.needsUpdate=!0)}setColors(e){const t=this.geometry.attributes.color.array,i=it(e),s=new a;for(let e=0;e<this.config.gpgpuSize*this.config.gpgpuSize;e++)i.getColorAt(Math.random(),s),s.toArray(t,3*e);this.geometry.attributes.color.needsUpdate=!0}update({time:e,pointer:t}){if(this.uniforms.uTime.value+=e.delta*this.config.noiseTimeCoef,t.hover)this.#pe.x=t.nPosition.x*this.#D.size.wWidth*.5,this.#pe.y=t.nPosition.y*this.#D.size.wHeight*.5;else{const t=e.elapsed*this.config.sleepTimeScale1,i=e.elapsed*this.config.sleepTimeScale2,s=Math.cos(t),n=Math.sin(i),o=this.config.sleepRadiusX*(this.#D.size.wWidth/this.#D.size.width),r=this.config.sleepRadiusY*(this.#D.size.wHeight/this.#D.size.height);this.#pe.x=o*s,this.#pe.y=r*n}this.uniforms.uPointerPosition.value.lerp(this.#pe,.1),this.#de.compute(),this.uniforms.tPosition.value=this.#de.getCurrentRenderTarget(this.positionVariable).texture,this.uniforms.tVelocity.value=this.#de.getCurrentRenderTarget(this.velocityVariable).texture}dispose(){this.#de.dispose()}}function Di(e,t={}){const i=new qe({canvas:e,size:"parent",rendererOptions:{alpha:!0,antialias:!1,stencil:!1,depth:!1}});i.camera.position.z=50,i.updateWorldSize();const s=new Z(i.scene,i.camera),n=new X(new r(i.size.width,i.size.height));n.radius=0,n.strength=.1,n.threshold=0;const o=new G,c=new Y(i.renderer);c.addPass(s),c.addPass(n),c.addPass(o),i.postprocessing=c;const l=new Ri(i,t);i.scene.add(l);const h=Ze({domElement:e});return i.onBeforeRender=e=>{l.update({time:e,pointer:h})},{three:i,bloomPass:n,particles:l,setBackgroundColor(e){i.scene.background=e?new a(e):null},dispose(){h.dispose(),l.dispose(),i.dispose()}}}function Li(e,t,i,s){let n=[0,0,0];n=[e[0]+Fi(e,[.3333333333333333,.3333333333333333,.3333333333333333]),e[1]+Fi(e,[.3333333333333333,.3333333333333333,.3333333333333333]),e[2]+Fi(e,[.3333333333333333,.3333333333333333,.3333333333333333])];let o=Ui(n);const r=Ii(n),a=ki([r[0],r[1],r[0]],[r[1],r[2],r[2]]),c=[1-a[0],1-a[1],1-a[2]],l=[c[2],a[0],a[1]],h=[c[0],c[1],a[2]],d=function(e,t){if(e.length)return t.length?e.map(function(e,i){return Math.min(e,t[i])}):e.map(function(e,i){return Math.min(e,t)});return Math.min(e,t)}(l,h),u=Ei(l,h);let m=[o[0]+d[0],o[1]+d[1],o[2]+d[2]],p=[o[0]+u[0],o[1]+u[1],o[2]+u[2]],f=[o[0]+1,o[1]+1,o[2]+1],v=[0,0,0],g=[0,0,0],y=[0,0,0],x=[0,0,0];v=[o[0]-Fi(o,[.16666666666666666,.16666666666666666,.16666666666666666]),o[1]-Fi(o,[.16666666666666666,.16666666666666666,.16666666666666666]),o[2]-Fi(o,[.16666666666666666,.16666666666666666,.16666666666666666])],g=[m[0]-Fi(m,[.16666666666666666,.16666666666666666,.16666666666666666]),m[1]-Fi(m,[.16666666666666666,.16666666666666666,.16666666666666666]),m[2]-Fi(m,[.16666666666666666,.16666666666666666,.16666666666666666])],y=[p[0]-Fi(p,[.16666666666666666,.16666666666666666,.16666666666666666]),p[1]-Fi(p,[.16666666666666666,.16666666666666666,.16666666666666666]),p[2]-Fi(p,[.16666666666666666,.16666666666666666,.16666666666666666])],x=[f[0]-Fi(f,[.16666666666666666,.16666666666666666,.16666666666666666]),f[1]-Fi(f,[.16666666666666666,.16666666666666666,.16666666666666666]),f[2]-Fi(f,[.16666666666666666,.16666666666666666,.16666666666666666])];const w=[e[0]-v[0],e[1]-v[1],e[2]-v[2]],z=[e[0]-g[0],e[1]-g[1],e[2]-g[2]],S=[e[0]-y[0],e[1]-y[1],e[2]-y[2]],b=[e[0]-x[0],e[1]-x[1],e[2]-x[2]];if(function(e){return e.some(function(e){return e})}(function(e,t){if(e.length){const i=Array(e.length);for(let s=0;s<e.length;s++)i[s]=e[s]>t[s];return i}return e>t}(t,[0,0,0]))){let e=[v[0],g[0],y[0],x[0]],i=[v[1],g[1],y[1],x[1]],s=[v[2],g[2],y[2],x[2]];t[0]>0&&(e=Ti(e,t[0])),t[1]>0&&(i=Ti(i,t[1])),t[2]>0&&(s=Ti(s,t[2])),v=[e[0],i[0],s[0]],g=[e[1],i[1],s[1]],y=[e[2],i[2],s[2]],x=[e[3],i[3],s[3]],o=[v[0]+Fi(v,[.3333333333333333,.3333333333333333,.3333333333333333]),v[1]+Fi(v,[.3333333333333333,.3333333333333333,.3333333333333333]),v[2]+Fi(v,[.3333333333333333,.3333333333333333,.3333333333333333])],m=[g[0]+Fi(g,[.3333333333333333,.3333333333333333,.3333333333333333]),g[1]+Fi(g,[.3333333333333333,.3333333333333333,.3333333333333333]),g[2]+Fi(g,[.3333333333333333,.3333333333333333,.3333333333333333])],p=[y[0]+Fi(y,[.3333333333333333,.3333333333333333,.3333333333333333]),y[1]+Fi(y,[.3333333333333333,.3333333333333333,.3333333333333333]),y[2]+Fi(y,[.3333333333333333,.3333333333333333,.3333333333333333])],f=[x[0]+Fi(x,[.3333333333333333,.3333333333333333,.3333333333333333]),x[1]+Fi(x,[.3333333333333333,.3333333333333333,.3333333333333333]),x[2]+Fi(x,[.3333333333333333,.3333333333333333,.3333333333333333])],o=Ui([o[0]+.5,o[1]+.5,o[2]+.5]),m=Ui([m[0]+.5,m[1]+.5,m[2]+.5]),p=Ui([p[0]+.5,p[1]+.5,p[2]+.5]),f=Ui([f[0]+.5,f[1]+.5,f[2]+.5])}const M=Vi(Oi.add([],Vi(Oi.add([],Vi([o[2],m[2],p[2],f[2]]),[o[1],m[1],p[1],f[1]])),[o[0],m[0],p[0],f[0]])),P=[3.883222077*M[0],3.883222077*M[1],3.883222077*M[2],3.883222077*M[3]],C=[-.006920415*M[0]+.996539792,-.006920415*M[1]+.996539792,-.006920415*M[2]+.996539792,-.006920415*M[3]+.996539792];let A=[.108705628*M[0],.108705628*M[1],.108705628*M[2],.108705628*M[3]];const R=Bi(P),D=_i(P),L=Ni([1-C[0]*C[0],1-C[1]*C[1],1-C[2]*C[2],1-C[3]*C[3]]);let T=[0,0,0,0],F=[0,0,0,0],U=[0,0,0,0];const I=D,k=[-R[0],-R[1],-R[2],-R[3]],E=[0,0,0,0],O=[C[0]*k[0],C[1]*k[1],C[2]*k[2],C[3]*k[3]],B=[-C[0]*I[0],-C[1]*I[1],-C[2]*I[2],-C[3]*I[3]],_=L;A=[A[0]+i,A[1]+i,A[2]+i,A[3]+i];const N=_i(A),V=Bi(A);T=[V[0]*O[0]+N[0]*I[0],V[1]*O[1]+N[1]*I[1],V[2]*O[2]+N[2]*I[2],V[3]*O[3]+N[3]*I[3]],F=[V[0]*B[0]+N[0]*k[0],V[1]*B[1]+N[1]*k[1],V[2]*B[2]+N[2]*k[2],V[3]*B[3]+N[3]*k[3]],U=[V[0]*_[0]+N[0]*E[0],V[1]*_[1]+N[1]*E[1],V[2]*_[2]+N[2]*E[2],V[3]*_[3]+N[3]*E[3]];const j=[T[0],F[0],U[0]],q=[T[1],F[1],U[1]],W=[T[2],F[2],U[2]],H=[T[3],F[3],U[3]];let Y=[Fi(w,w),Fi(z,z),Fi(S,S),Fi(b,b)].map(function(e){return.5-e});Y=Ei(Y,0);const Z=[Y[0]*Y[0],Y[1]*Y[1],Y[2]*Y[2],Y[3]*Y[3]],X=[Z[0]*Y[0],Z[1]*Y[1],Z[2]*Y[2],Z[3]*Y[3]],G=[Fi(j,w),Fi(q,z),Fi(W,S),Fi(H,b)],Q=Fi(X,G),$=[-6*Z[0]*G[0],-6*Z[1]*G[1],-6*Z[2]*G[2],-6*Z[3]*G[3]],J=[X[0]*j[0]+$[0]*w[0],X[0]*j[1]+$[0]*w[1],X[0]*j[2]+$[0]*w[2]],K=[X[1]*q[0]+$[1]*z[0],X[1]*q[1]+$[1]*z[1],X[1]*q[2]+$[1]*z[2]],ee=[X[2]*W[0]+$[2]*S[0],X[2]*W[1]+$[2]*S[1],X[2]*W[2]+$[2]*S[2]],te=[X[3]*H[0]+$[3]*b[0],X[3]*H[1]+$[3]*b[1],X[3]*H[2]+$[3]*b[2]];return s[0]=39.5*(J[0]+K[0]+ee[0]+te[0]),s[1]=39.5*(J[1]+K[1]+ee[1]+te[1]),s[2]=39.5*(J[2]+K[2]+ee[2]+te[2]),39.5*Q}function Ti(e,t){return e.length?t.length?e.map(function(e,i){return 0===e||0===t[i]?0:e%t[i]}):e.map(function(e,i){return 0===e||0===t?0:e%t}):e%t}function Fi(e,t){let i=0;for(let s=0;s<e.length;s++)i+=e[s]*t[s];return i}function Ui(e){return e.length?e.map(Ui):Math.floor(e)}function Ii(e){return e.length?e.map(Ii):e-Math.floor(e)}function ki(e,t){return t||e?t.length?e.length?t.map(function(t,i){return ki(e[i],t)}):t.map(function(t,i){return ki(e,t)}):t<e?0:1:0}function Ei(e,t){return e.length?t.length?e.map(function(e,i){return Math.max(e,t[i])}):e.map(function(e,i){return Math.max(e,t)}):Math.max(e,t)}function Oi(e,t,i,s){return null==e&&(e=0),null==t&&(t=e),null==i&&(i=t),null==s&&(s=i),[e,t,i,s]}function Bi(e){return e.length?e.map(Bi):Math.cos(e)}function _i(e){return e.length?e.map(_i):Math.sin(e)}function Ni(e){return e.length?e.map(Ni):Math.sqrt(e)}function Vi(e){const t=Ti(e,289);return Ti([(34*t[0]+10)*t[0],(34*t[1]+10)*t[1],(34*t[2]+10)*t[2],(34*t[3]+10)*t[3]],289)}Oi.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e};const ji=new Float32Array(3),qi=new Float32Array(3),Wi=new Float32Array(3);class Hi extends Se{timeDelta=100*Math.random();constructor(e,t){const i=e.tubularSegments||64,s=e.radius||.5,n=e.radialSegments||8,o=e.capSegments||4;super(new Yi(i,s,n,o),t),this.curve=this.geometry.curve,this.points=this.curve.points,this.to=new re,this.geometry.update()}lerpTo(e,t=.1,i=.05,s){Wi[0]=.01*e.x+.04*s+this.timeDelta,Wi[1]=.01*e.y+.048*s+this.timeDelta,Wi[2]=.01*e.z+.06*s+this.timeDelta,Li(Wi,ji,2*s,qi),this.to.copy(e),this.to.x+=qi[0]*i,this.to.y+=qi[1]*i,this.to.z+=qi[2]*i,this.points[0].lerp(this.to,t);for(let e=1;e<this.points.length;e++)this.points[e].lerp(this.points[e-1],t);this.geometry.update()}}class Yi extends be{constructor(e=64,t=1,i=8){const s=new Array(e+1).fill(0).map(()=>new re);s.forEach((t,i)=>{t.z=-i/e*2});const n=new Me(s);super(n,e,t,i,!1),this.curve=n}update(){!function(e){const{curve:t}=e,{tubularSegments:i,radius:s,radialSegments:n}=e.parameters,o=t.computeFrenetFrames(t.points.length,!1);e.tangents=o.tangents,e.normals=o.normals,e.binormals=o.binormals;const r=e.getAttribute("position"),a=e.getAttribute("normal"),c=new re,l=new re;for(let e=0;e<=i;e++)h(e);function h(e){const h=e/i,d=Math.sin(h*Math.PI)*s;l.copy(t.points[e]);let u=e*(n+1);const m=o.normals[e],p=o.binormals[e];for(let e=0;e<=n;e++){const t=e/n*Math.PI*2,i=Math.sin(t),s=-Math.cos(t);c.x=s*m.x+i*p.x,c.y=s*m.y+i*p.y,c.z=s*m.z+i*p.z,c.normalize(),r.setXYZ(u,l.x+d*c.x,l.y+d*c.y,l.z+d*c.z),a.setXYZ(u,c.x,c.y,c.z),u++}}r.needsUpdate=!0,a.needsUpdate=!0}(this)}}const Zi={count:16,colors:["#f967fb","#53bc28","#6958d5"],minRadius:.005,maxRadius:.05,minTubularSegments:32,maxTubularSegments:128,material:{metalness:1,roughness:.25},lights:{intensity:200,colors:["#83f36e","#fe8a2e","#ff008a","#60aed5"]},lerp:.5,noise:.05};class Xi extends ie{target=new re;lights=[];tubes=[];constructor(e){super(),this.options={...Zi,...e},this.init()}init(){this.initLights(),this.initTubes()}initLights(){for(let e=0;e<4;e++){const t=new Pe(this.options.lights.colors[e],this.options.lights.intensity);t.position.set(e<2?-5:5,e%2==0?-5:5,5),this.lights.push(t),this.add(t)}}initTubes(){for(let e=0;e<this.options.count;e++){const t=oe.randFloat(this.options.minRadius,this.options.maxRadius),i=oe.randInt(this.options.minTubularSegments,this.options.maxTubularSegments),s=new Ce(this.options.material);this.tubes[e]=new Hi({radius:t,tubularSegments:i},s),this.add(this.tubes[e])}this.setColors(this.options.colors)}setColors(e){const t=it(e);this.tubes.forEach((e,i)=>{e.material.color.set(t.getColorAt(i/(this.tubes.length-1)))})}setLightsColors(e){for(let t=0;t<4;t++)this.lights[t].color.set(e[t])}setLightsIntensity(e){this.lights.forEach(t=>{t.intensity=e})}setMaterialOption(e,t){this.tubes.forEach(i=>{i.material[e]=t})}update(e){for(let t=0;t<this.options.count;t++)this.tubes[t].lerpTo(this.target,this.options.lerp,this.options.noise,e.elapsed)}}const Gi={bloom:{threshold:0,strength:1.5,radius:.5},tubes:{},sleepRadiusX:300,sleepRadiusY:150,sleepTimeScale1:1,sleepTimeScale2:2};function Qi(e,t={}){const i={...Gi,...t},s=new gi({canvas:e,size:"parent",rendererOptions:{alpha:!0,antialias:!1}});s.camera.position.set(0,0,5),s.camera.lookAt(0,0,0),s.cameraMaxAspect=1.5,s.minPixelRatio=2,s.maxPixelRatio=2,s.resize();const n=new Xi(i.tubes);let o;if(s.scene=n,i.bloom){const e=new de(s.renderer),t=Be(s.scene,s.camera).getTextureNode("output");o=Ve(t,i.bloom.strength,i.bloom.radius,i.bloom.threshold),e.outputNode=t.add(o),s.render=e.render.bind(e)}const r=new ue,a=new me(new re(0,0,1),0),c=new re,l=Ze({domElement:e,onMove(){r.setFromCamera(l.nPosition,s.camera),s.camera.getWorldDirection(a.normal),r.ray.intersectPlane(a,c)}});return s.onBeforeRender=function(e){if(l.hover)n.target.copy(c);else{const t=s.size.wWidth/s.size.width,o=i.sleepRadiusX*t,r=i.sleepRadiusY*t;n.target.x=o*Math.cos(e.elapsed*i.sleepTimeScale1),n.target.y=r*Math.sin(e.elapsed*i.sleepTimeScale2)}n.update(e)},{three:s,options:i,tubes:n,get bloomPass(){return o},dispose(){l.dispose(),s.dispose()}}}export{bi as Attraction1Cursor,at as Bokeh1Background,pt as Grid1Background,Mt as Liquid1Background,Rt as Neon1Background,Pi as Neon1Cursor,Di as Particles1Cursor,Lt as ShadertoyBackground,Zt as Spheres1Background,li as Spheres2Background,vi as Starfield1Background,qe as Three,Qi as Tubes1Cursor};
